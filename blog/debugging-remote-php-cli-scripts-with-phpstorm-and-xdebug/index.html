<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html class="no-js" lang="en"><!--<![endif]-->

<head>
  <meta charset="utf-8">

  <title>Debug Remote PHP CLI Scripts - axiac@web</title>
  <meta name="author" content="axiac">


  <meta name="description" content="I had to debug a command line PHP script that runs on a remote server and I could not figure out how to do it.
I am using PhpStorm and XDebug. &hellip;">


  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <link rel="canonical" href="https://axiac.ro/blog/debugging-remote-php-cli-scripts-with-phpstorm-and-xdebug/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="axiac@web" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js" async></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript" async></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  <script>
      (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
          (i[r].q = i[r].q || []).push(arguments);
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
          m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m);
      })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-545821-11', 'axiac.ro');
    if (navigator.userAgent.indexOf('axiac') == -1) {
      ga('send', 'pageview');
    }
  </script>






  <meta property="fb:app_id" content="128516770538860" />


  <meta property="og:url" content="https://axiac.ro/blog/debugging-remote-php-cli-scripts-with-phpstorm-and-xdebug/" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="Debug Remote PHP CLI Scripts - axiac@web" />
  <meta property="og:description" content="I had to debug a command line PHP script that runs on a remote server and I could not figure out how to do it.
I am using PhpStorm and XDebug. PhpStorm comes with a rich set of configurations to run a PHP script, including a couple of presets for debug.
I used them to debug web pages and command &hellip;" />
  <meta property="og:image" content="https://axiac.ro/favicon.png" />

  <meta property="og:author" content="https://www.facebook.com/axiac.ro/" />



</head>

<body>
  <header role="banner">
    <hgroup>
      <h1><a href="/">axiac@web</a></h1>

    </hgroup>

  </header>
  <nav role="navigation">
    <ul class="subscription" data-subscription="rss">
      <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>

    </ul>

    <form action="https://www.google.com/search" method="get">
      <fieldset role="search">
        <input type="hidden" name="q" value="site:axiac.ro" />
        <input class="search" type="text" name="q" results="0" placeholder="Search" />
      </fieldset>
    </form>

    <ul class="main-navigation">
      <li><a href="/">Blog</a></li>
      <li><a href="/blog/archives">Archives</a></li>
    </ul>

  </nav>
  <div id="main">
    <div id="content">
      <div>
        <article class="hentry" role="article">

          <header>


            <h1 class="entry-title">Debug Remote PHP CLI Scripts</h1>


            <p class="meta">





              <time class='updated' datetime='2014-03-04'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>4</span><span
                    class='date-suffix'>th</span>, <span class='date-year'>2014</span></span></time>

            </p>

          </header>


          <div class="entry-content">
            <p>I had to debug a command line PHP script that runs on a remote server and I could not figure out how to do it.
              I am using <a href="http://www.jetbrains.com/phpstorm">PhpStorm</a> and <a href="http://xdebug.org">XDebug</a>.</p>

            <p>PhpStorm comes with a rich set of configurations to run a PHP script, including a couple of presets for debug.
              I used them to debug web pages and command line scripts running on the local computer but nothing worked for
              scripts running on remote servers.</p>

            <p>By reading the documentation of XDebug and PhpStorm I learned that some small tasks must be accomplished
              in order to make PhpStorm and XDebug co-operate for debugging.</p>

            <!-- more -->


            <p><a name="xdebug-config"></a></p>

            <h2>Installing and configuring XDebug</h2>

            <p>Installing XDebug depends on the OS that runs on the remote server and everything is explained in the
              <a href="http://xdebug.org/docs/">XDebug documentation</a>.
            </p>

            <p>A single line of configuration is required. In <code>php.ini</code> add:</p>

            <figure class='code'>
              <div class="highlight">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre class="line-numbers"><span class='line-number'>1</span>
</pre>
                    </td>
                    <td class='code'>
                      <pre><code class='ini'><span class='line'><span class="na">xdebug.remote_enable</span><span class="o">=</span><span class="s">1</span>
</span></code></pre>
                    </td>
                  </tr>
                </table>
              </div>
            </figure>


            <h2>Starting the debugger client</h2>

            <p>Due to the way the PHP scripts are invoked by the web server, the communication between the PHP debugger extension
              and the debugger client (the IDE) is initiated by the PHP extension. The IDE must be told to start listening for
              connections first. PhpStorm has a entry in the <em>Run</em> menu named <em>Start Listen for PHP Debug Connections</em> to
              accomplish this task.</p>

            <h2>Starting the debugger extension</h2>

            <p>Because debugging is not the normal way to run a PHP script, the debugging does not start by only installing
              and configuring the XDebug extension. It requires the presence of a special variable in the request or in the
              environment.</p>

            <p>For CLI scripts this is the environment variable <code>XDEBUG_CONFIG</code>. While its mere presence is enough
              to start the debugging, its content is also important: it can be used to override the values declared in <code>php.ini</code>.<br>
              More details in the XDebug <a href="http://xdebug.org/docs/remote#starting">documentation</a>.</p>

            <figure class='code'>
              <div class="highlight">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre class="line-numbers"><span class='line-number'>1</span>
</pre>
                    </td>
                    <td class='code'>
                      <pre><code class='sh'><span class='line'><span class="nv">XDEBUG_CONFIG</span><span class="o">=</span><span class="s1">&#39;&#39;</span> php script.php
</span></code></pre>
                    </td>
                  </tr>
                </table>
              </div>
            </figure>


            <p>By prepending the command line with the initialization of the environment variable, the variable is set only
              for that specific execution of the PHP interpreter. To make the variable available on the subsequent commands
              it should be set in the shell and <code>export</code>ed for all the applications that will run in the current session:</p>

            <figure class='code'>
              <div class="highlight">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre>
                    </td>
                    <td class='code'>
                      <pre><code class='sh'><span class='line'><span class="nb">export </span><span class="nv">XDEBUG_CONFIG</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span><span class='line'>php script.php
</span></code></pre>
                    </td>
                  </tr>
                </table>
              </div>
            </figure>


            <p>This is not always the best option but it can help if you are expecting a heavy debug session.</p>

            <h2>Configuring path mapping</h2>

            <p>Because on the remote host the script is usually located on a different path than on the local machine,
              PhpStorm needs a way to know how to map the remote path to the local path. When the debug session starts,
              PhpStorm asks the debugger about the value of the environment variable <code>PHP_IDE_CONFIG</code> (if it is set.)</p>

            <p>Its value should look like <code>serverName=name</code> where <em>&lsquo;name&rsquo;</em> is the name of the server configured in
              <em>Project Settings->PHP->Servers</em>.
            </p>

            <p>The most convenient way to set this variable to the debugged script is to pass it to the interpreter
              as an environment variable.</p>

            <figure class='code'>
              <div class="highlight">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre>
                    </td>
                    <td class='code'>
                      <pre><code class='sh'><span class='line'><span class="nb">export </span><span class="nv">PHP_IDE_CONFIG</span><span class="o">=</span><span class="s2">&quot;serverName=devel-host&quot;</span>
</span><span class='line'><span class="nv">XDEBUG_CONFIG</span><span class="o">=</span><span class="s1">&#39;&#39;</span> php script.php
</span></code></pre>
                    </td>
                  </tr>
                </table>
              </div>
            </figure>


            <p>Check <a href="http://blog.jetbrains.com/webide/2012/03/new-in-4-0-easier-debugging-of-remote-php-command-line-scripts/">this post</a> on
              PhpStorms&rsquo;s blog for details.</p>

            <h2>What else is missing?</h2>

            <p>I followed all the steps above by the book, double checked them, but the remote debugger continued to ignore
              all my efforts. I searched on the Internet but the directions I could find did not help very much. So, I went
              back to the documentation.</p>

            <p>XDebug provides an exhaustive <a href="http://xdebug.org/docs/remote">description</a> of how to set up remote PHP debugging. It explains
              there how the debug extension communicates with the client program (PhpStorm, in my case) and this was
              the starting point on the path to the solution of the problem.</p>

            <p>Back to the <a href="#xdebug-config">XDebug configuration</a>, <code>xdebug.remote_connect=1</code> tells it to attempt to connect
              to the host defined by <code>xdebug.remote_host</code> on port defined by <code>xdebug.remote_port</code>. The default values for
              them are <code>localhost</code> and <code>9000</code>.<br>
              Keep in mind that <code>localhost</code> refers to the host where the XDebug runs and that is the remote host and not
              the machine where the PhpStorm runs. This is why XDebug cannot communicate with PhpStorm.</p>

            <p>Setting <code>xdebug.remote_host</code> to the IP address of the local machine should do the trick, except that I cannot
              make it work. The remote server where the PHP scripts run is somewhere in the Internet. The workstation where
              PhpStorm runs is connected to a LAN that is behind a firewall. It uses an intranet IP address (<code>192.168.*.*</code>)
              and this (and the firewall) prevents the XDebug extension to call back to the IDE in order to start debugging.</p>

            <h2>Eventually, the solution</h2>

            <p>The solution is simple: create a SSH tunnel from port <code>9000</code> on the remote server to port <code>9000</code> of the local
              machine.</p>

            <p>In order to start the PHP script on the remote server, I already log into the remote machine using <code>ssh</code>.
              All I had to do was to log out then log in again appending <code>-R 9000:localhost:9000</code> to the <code>ssh</code> command line.</p>

            <figure class='code'>
              <div class="highlight">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre class="line-numbers"><span class='line-number'>1</span>
</pre>
                    </td>
                    <td class='code'>
                      <pre><code class='sh'><span class='line'>ssh user@remote-host -R 9000:localhost:9000
</span></code></pre>
                    </td>
                  </tr>
                </table>
              </div>
            </figure>


            <p>Then I set up the environment variables as above, started the PHP script and the magic happened.</p>
          </div>


          <footer>
            <p class="meta">



              <span class="byline author vcard">Posted by <span class="fn">axiac</span></span>






              <time class='updated' datetime='2014-03-04'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>4</span><span
                    class='date-suffix'>th</span>, <span class='date-year'>2014</span></span></time>


              <span class="categories">

                <a class='category' href='/blog/categories/php/'>php</a>, <a class='category' href='/blog/categories/troubleshooting/'>troubleshooting</a>

              </span>


            </p>

            <div class="sharing">

              <a href="//twitter.com/share" class="twitter-share-button"
                data-url="https://axiac.ro/blog/debugging-remote-php-cli-scripts-with-phpstorm-and-xdebug/" data-via="axiac"
                data-counturl="https://axiac.ro/blog/debugging-remote-php-cli-scripts-with-phpstorm-and-xdebug/">Tweet</a>


              <div class="g-plusone" data-size="medium"></div>


              <div class="fb-like" data-share="true" data-width="450" data-show-faces="false"></div>

            </div>


            <div class="fb-comments" data-href="https://axiac.ro/blog/debugging-remote-php-cli-scripts-with-phpstorm-and-xdebug/" data-numposts="5"
              data-width="789"></div>



            <p class="meta">

              <a class="basic-alignment left" href="/blog/sh-1-t-not-found/" title="Previous Post: sh: 1: -t: not found">&laquo; sh: 1: -t: not found</a>


              <a class="basic-alignment right" href="/blog/sa-se-afle-ultimele-4-cifre-ale-numarului/"
                title="Next Post: Să se afle ultimele 4 cifre ale numărului">Să se afle ultimele 4 cifre ale numărului &raquo;</a>

            </p>
          </footer>
        </article>

        <section>
          <h1>Comments</h1>
          <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered
                by Disqus.</a></noscript>
          </div>
        </section>

      </div>

      <aside class="sidebar">

        <section>
          <h1>Recent Posts</h1>
          <ul id="recent_posts">


            <li class="post">
              <a href="/blog/why-is-mysql-time-limited-to-838-59-59/">Why Is MySQL Time Limited to 838:59:59?</a>
            </li>


            <li class="post">
              <a href="/blog/git-ignores-me-not-my-files/">Git Ignores Me, Not My Files</a>
            </li>


            <li class="post">
              <a href="/blog/how-to-merge-composer-files/">How to Merge Composer Files</a>
            </li>


            <li class="post">
              <a href="/blog/public-properties-are-not-oop/">Public Properties Are Not OOP</a>
            </li>


            <li class="post">
              <a href="/blog/atlassian-sourcetree-and-git-hooks/">Atlassian SourceTree and Git hooks</a>
            </li>

          </ul>
        </section>



        <section class="googleplus googleplus-hidden">
          <h1>
            <a href="https://plus.google.com/116025233500446558681?rel=author">
              <img src="//www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
              Google+
            </a>
          </h1>
        </section>




      </aside>


    </div>
  </div>
  <footer role="contentinfo">
    <p>
      Copyright &copy; 2013-2020 - axiac -
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
    </p>

  </footer>


  <script type="text/javascript">
    var disqus_shortname = 'axiac';


    // var disqus_developer = 1;
      var disqus_identifier = 'https://axiac.ro/blog/debugging-remote-php-cli-scripts-with-phpstorm-and-xdebug/';
      var disqus_url = 'https://axiac.ro/blog/debugging-remote-php-cli-scripts-with-phpstorm-and-xdebug/';
    var disqus_script = 'embed.js';

    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
  </script>



  <div id="fb-root"></div>
  <script>
    window.fbAsyncInit = function () {
      FB.init({
        appId: '128516770538860',
        xfbml: true,
        version: 'v2.5'
      });
    };

    (function (d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) { return; }
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/sdk.js";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
  </script>



  <script type="text/javascript">
    (function () {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function () {
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  <script type="text/javascript">
    setTimeout(function () {
      var a = document.createElement("script");
      var b = document.getElementsByTagName("script")[0];
      a.src = document.location.protocol + "//script.crazyegg.com/pages/scripts/0019/4087.js?" + Math.floor(new Date().getTime() / 3600000);
      a.async = true; a.type = "text/javascript"; b.parentNode.insertBefore(a, b);
    }, 1);
  </script>


  <script type="text/javascript" id="inspectletjs">
    window.__insp = window.__insp || [];
    __insp.push(['wid', 1818118537]);
    (function () {
      function __ldinsp() { var insp = document.createElement('script'); insp.type = 'text/javascript'; insp.async = true; insp.id = "inspsync"; insp.src = ('https:' == document.location.protocol ? 'https' : 'http') + '://cdn.inspectlet.com/inspectlet.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(insp, x); }
      if (window.attachEvent) {
        window.attachEvent('onload', __ldinsp);
      } else {
        window.addEventListener('load', __ldinsp, false);
      }
    })();
  </script>



</body>

</html>

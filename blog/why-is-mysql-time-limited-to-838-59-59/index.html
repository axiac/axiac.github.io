<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html class="no-js" lang="en"><!--<![endif]-->

<head>
  <meta charset="utf-8">

  <title>Why Is MySQL Time Limited to 838:59:59? - axiac@web</title>
  <meta name="author" content="axiac">


  <meta name="description"
    content="An interesting question from Stack Overflow asks &ldquo;Why is MySQL&rsquo;s maximum time limit 838:59:59?&rdquo; The official reference at http:// &hellip;">


  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <link rel="canonical" href="https://axiac.ro/blog/why-is-mysql-time-limited-to-838-59-59/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="axiac@web" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js" async></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript" async></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  <script>
      (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
          (i[r].q = i[r].q || []).push(arguments);
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
          m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m);
      })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-545821-11', 'axiac.ro');
    if (navigator.userAgent.indexOf('axiac') == -1) {
      ga('send', 'pageview');
    }
  </script>






  <meta property="fb:app_id" content="128516770538860" />


  <meta property="og:url" content="https://axiac.ro/blog/why-is-mysql-time-limited-to-838-59-59/" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="Why Is MySQL Time Limited to 838:59:59? - axiac@web" />
  <meta property="og:description" content="An interesting question from Stack Overflow asks &ldquo;Why is MySQL&rsquo;s maximum time limit 838:59:59?&rdquo; The official reference at http://dev.mysql.com/doc/refman/5.7/en/time.html says TIME values may range from -838:59:59 to 838:59:59. The hours part may be so large
because the TIME type &hellip;" />
  <meta property="og:image" content="https://axiac.ro/favicon.png" />

  <meta property="og:author" content="https://www.facebook.com/axiac.ro/" />



</head>

<body>
  <header role="banner">
    <hgroup>
      <h1><a href="/">axiac@web</a></h1>

    </hgroup>

  </header>
  <nav role="navigation">
    <ul class="subscription" data-subscription="rss">
      <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>

    </ul>

    <form action="https://www.google.com/search" method="get">
      <fieldset role="search">
        <input type="hidden" name="q" value="site:axiac.ro" />
        <input class="search" type="text" name="q" results="0" placeholder="Search" />
      </fieldset>
    </form>

    <ul class="main-navigation">
      <li><a href="/">Blog</a></li>
      <li><a href="/blog/archives">Archives</a></li>
    </ul>

  </nav>
  <div id="main">
    <div id="content">
      <div>
        <article class="hentry" role="article">

          <header>


            <h1 class="entry-title">Why Is MySQL Time Limited to 838:59:59?</h1>


            <p class="meta">





              <time class='updated' datetime='2017-07-28'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>28</span><span
                    class='date-suffix'>th</span>, <span class='date-year'>2017</span></span></time>

            </p>

          </header>


          <div class="entry-content">
            <p>An interesting question from <a href="https://stackoverflow.com/q/39259910/4265352">Stack Overflow</a> asks <em>&ldquo;Why is MySQL&rsquo;s
                maximum time limit 838:59:59?&rdquo;</em></p>

            <p>The official reference at <a href="http://dev.mysql.com/doc/refman/5.7/en/time.html">http://dev.mysql.com/doc/refman/5.7/en/time.html</a> says
            </p>

            <blockquote>
              <p><code>TIME</code> values may range from <code>-838:59:59</code> to <code>838:59:59</code>. The hours part may be so large
                because the <code>TIME</code> type can be used not only to represent a time of day (which must be
                less than 24 hours), but also elapsed time or a time interval between two events
                (which may be much greater than 24 hours, or even negative).</p>
            </blockquote>

            <p>The <code>TIME</code> values were always stored on 3 bytes in MySQL. But the format changed on <a
                href="http://dev.mysql.com/doc/internals/en/date-and-time-data-type-representation.html">version 5.6.4</a>.</p>

            <!-- more -->


            <p>I suspect this was not the first time when it changed. But the other change, if there was one, happened
              long time ago and there is no public evidence of it. The MySQL source code history on GitHub starts with
              version 5.5 (the oldest commit is from May 2008) but the change I am looking for happened somewhere
              around 2001-2002. The first stable release of MySQL 4 (version 4.0.4) was launched in September 2002.</p>

            <h3>How the <code>TIME</code> values are stored since version 5.6.4</h3>

            <p>The current format, as described in the <a href="http://dev.mysql.com/doc/refman/5.7/en/time.html">documentation</a>, uses the 24 bits as
              follows:</p>

            <ul>
              <li>6 bits for seconds (possible values: <code>0</code> to <code>63</code>);</li>
              <li>6 bits for minutes (again, possible values: <code>0</code> to <code>63</code>);</li>
              <li>10 bits for hours (possible values: <code>0</code> to <code>1023</code>);</li>
              <li>1 bit for sign;</li>
              <li>1 bit is unused and labelled <em>&ldquo;reserved for future extensions&rdquo;</em>.</li>
            </ul>


            <p>It is optimized for working with time components (hours, minutes, seconds) and it doesn&rsquo;t waste much space.
              Using this format it&rsquo;s possible to store values between <code>-1023:59:59</code> and <code>+1023:59:59</code>.
              However MySQL limits the number of hours to <code>838</code>, probably for backward compatibility with applications
              that were written a while ago, when I think <code>838</code> hours was the upper limit.</p>

            <h3>The format of <code>TIME</code> before version 5.6.4</h3>

            <p>Until version 5.6.4, the <code>TIME</code> values were also stored on 3 bytes and the components were packed as
              <code>days * 24 * 3600 + hours * 3600 + minutes * 60 + seconds</code>.<br>
              This format was optimized for working with timestamps (because it was, in fact, a timestamp).
              Using this format it would be possible to store values in the range of about <code>-2330</code> to <code>+2330</code> hours.
            </p>

            <p>I think this format was introduced in MySQL 4.</p>

            <p>While having this big range of values available, MySQL was still limiting the values to <code>-838</code> to <code>+838</code> hours
              for compatibility with applications developed on MySQL 3.</p>

            <h3>The format of <code>TIME</code> before MySQL 4</h3>

            <p>There was <a href="https://bugs.mysql.com/bug.php?id=11655">bug #11655</a> on MySQL 4. It was possible to return <code>TIME</code> values outside
              the <code>-838..+838</code>
              range using nested <code>SELECT</code> statements. It was not a feature but a bug and it was fixed.</p>

            <p>The only reason to limit the values to this range and to actively change any piece of code that produces
              <code>TIME</code> values outside it was backward compatibility.
            </p>

            <p>I suspect MySQL 3 used a different format that, due to the way the data was packed,
              limited the valid values to the range <code>-838..+838</code> hours.</p>

            <p>By looking into the current <a href="https://github.com/mysql/mysql-server/blob/5.7/include/my_time.h#L94">MySQL&rsquo;s source code</a> I found
              this interesting formula:</p>

            <pre><code>#define TIME_MAX_VALUE (TIME_MAX_HOUR*10000 + TIME_MAX_MINUTE*100 + TIME_MAX_SECOND)
</code></pre>

            <p>Let&rsquo;s ignore for the moment the <em><code>MAX</code></em> part of the names used above and let&rsquo;s remember only that
              <code>TIME_MAX_MINUTE</code> and <code>TIME_MAX_SECOND</code> are numbers between <code>00</code> and <code>59</code>.
              The formula just concatenates the hours, minutes and seconds in a single integer number.<br>
              For example, the value <code>170:29:45</code> becomes <code>1702945</code>.
            </p>

            <p>This formula raises the following question: given that the <code>TIME</code> values are stored on 3 bytes with sign,
              what is the maximum positive value that can be represented this way?</p>

            <p>The maximum value that can be stored on 3 digits with sign is <code>0x7FFFFF</code> that in decimal notation is <code>8388607</code>.
              Since the last four digits (<code>8607</code>) should be read as minutes (<code>86</code>) and seconds (<code>07</code>) and their maximum
              valid value is <code>59</code>, the greatest value that can be stored on 3 bytes with sign using the formula above is <code>8385959</code>.
              Which, as <code>TIME</code> is <code>+838:59:59</code>. Ta-da!</p>

            <p>Guess what? The fragment of <code>C</code> code listed above was extracted from:</p>

            <figure class='code'>
              <figcaption><span>my_time.h</span><a href='https://github.com/mysql/mysql-server/blob/5.7/include/my_time.h#L90'>See the file on Github </a>
              </figcaption>
              <div class="highlight">
                <table>
                  <tr>
                    <td class="gutter">
                      <pre class="line-numbers"><span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
</pre>
                    </td>
                    <td class='code'>
                      <pre><code class='c'><span class='line'><span class="cm">/* Limits for the TIME data type */</span>
</span><span class='line'><span class="cp">#define TIME_MAX_HOUR 838</span>
</span><span class='line'><span class="cp">#define TIME_MAX_MINUTE 59</span>
</span><span class='line'><span class="cp">#define TIME_MAX_SECOND 59</span>
</span><span class='line'><span class="cp">#define TIME_MAX_VALUE (TIME_MAX_HOUR*10000 + TIME_MAX_MINUTE*100 + TIME_MAX_SECOND)</span>
</span></code></pre>
                    </td>
                  </tr>
                </table>
              </div>
            </figure>


            <p>Now I am sure this is how MySQL 3 used to keep the <code>TIME</code> values internally. This format imposed the limitation
              of the range, and the backward compatibility requirement on the subsequent versions propagated
              the limitation to our days.</p>
          </div>


          <footer>
            <p class="meta">



              <span class="byline author vcard">Posted by <span class="fn">axiac</span></span>






              <time class='updated' datetime='2017-07-28'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>28</span><span
                    class='date-suffix'>th</span>, <span class='date-year'>2017</span></span></time>


              <span class="categories">

                <a class='category' href='/blog/categories/mysql/'>mysql</a>, <a class='category' href='/blog/categories/troubleshooting/'>troubleshooting</a>

              </span>


            </p>

            <div class="sharing">

              <a href="//twitter.com/share" class="twitter-share-button" data-url="https://axiac.ro/blog/why-is-mysql-time-limited-to-838-59-59/"
                data-via="axiac" data-counturl="https://axiac.ro/blog/why-is-mysql-time-limited-to-838-59-59/">Tweet</a>


              <div class="g-plusone" data-size="medium"></div>


              <div class="fb-like" data-share="true" data-width="450" data-show-faces="false"></div>

            </div>


            <div class="fb-comments" data-href="https://axiac.ro/blog/why-is-mysql-time-limited-to-838-59-59/" data-numposts="5" data-width="789"></div>



            <p class="meta">

              <a class="basic-alignment left" href="/blog/git-ignores-me-not-my-files/" title="Previous Post: Git ignores me, not my files">&laquo; Git ignores
                me, not my files</a>


            </p>
          </footer>
        </article>

        <section>
          <h1>Comments</h1>
          <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered
                by Disqus.</a></noscript>
          </div>
        </section>

      </div>

      <aside class="sidebar">

        <section>
          <h1>Recent Posts</h1>
          <ul id="recent_posts">


            <li class="post">
              <a href="/blog/why-is-mysql-time-limited-to-838-59-59/">Why Is MySQL Time Limited to 838:59:59?</a>
            </li>


            <li class="post">
              <a href="/blog/git-ignores-me-not-my-files/">Git Ignores Me, Not My Files</a>
            </li>


            <li class="post">
              <a href="/blog/how-to-merge-composer-files/">How to Merge Composer Files</a>
            </li>


            <li class="post">
              <a href="/blog/public-properties-are-not-oop/">Public Properties Are Not OOP</a>
            </li>


            <li class="post">
              <a href="/blog/atlassian-sourcetree-and-git-hooks/">Atlassian SourceTree and Git hooks</a>
            </li>

          </ul>
        </section>



        <section class="googleplus googleplus-hidden">
          <h1>
            <a href="https://plus.google.com/116025233500446558681?rel=author">
              <img src="//www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
              Google+
            </a>
          </h1>
        </section>




      </aside>


    </div>
  </div>
  <footer role="contentinfo">
    <p>
      Copyright &copy; 2013-2020 - axiac -
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
    </p>

  </footer>


  <script type="text/javascript">
    var disqus_shortname = 'axiac';


    // var disqus_developer = 1;
      var disqus_identifier = 'https://axiac.ro/blog/why-is-mysql-time-limited-to-838-59-59/';
      var disqus_url = 'https://axiac.ro/blog/why-is-mysql-time-limited-to-838-59-59/';
    var disqus_script = 'embed.js';

    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
  </script>



  <div id="fb-root"></div>
  <script>
    window.fbAsyncInit = function () {
      FB.init({
        appId: '128516770538860',
        xfbml: true,
        version: 'v2.5'
      });
    };

    (function (d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) { return; }
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/sdk.js";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
  </script>



  <script type="text/javascript">
    (function () {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function () {
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  <script type="text/javascript">
    setTimeout(function () {
      var a = document.createElement("script");
      var b = document.getElementsByTagName("script")[0];
      a.src = document.location.protocol + "//script.crazyegg.com/pages/scripts/0019/4087.js?" + Math.floor(new Date().getTime() / 3600000);
      a.async = true; a.type = "text/javascript"; b.parentNode.insertBefore(a, b);
    }, 1);
  </script>


  <script type="text/javascript" id="inspectletjs">
    window.__insp = window.__insp || [];
    __insp.push(['wid', 1818118537]);
    (function () {
      function __ldinsp() { var insp = document.createElement('script'); insp.type = 'text/javascript'; insp.async = true; insp.id = "inspsync"; insp.src = ('https:' == document.location.protocol ? 'https' : 'http') + '://cdn.inspectlet.com/inspectlet.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(insp, x); }
      if (window.attachEvent) {
        window.attachEvent('onload', __ldinsp);
      } else {
        window.addEventListener('load', __ldinsp, false);
      }
    })();
  </script>



</body>

</html>
